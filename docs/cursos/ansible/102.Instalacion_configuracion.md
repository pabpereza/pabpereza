---
title: Instalaci√≥n y Configuraci√≥n
sidebar_label: 2. Instalaci√≥n
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Instalaci√≥n y configuraci√≥n ‚öôÔ∏è

Prepara tu entorno de trabajo para empezar a automatizar.

:::info Video pendiente de grabaci√≥n
:::

## 2.1. requisitos previos (python)

### ‚õΩ La analog√≠a: el combustible
Imagina que Ansible es un **Ferrari** üèéÔ∏è. Es r√°pido, potente y rojo (bueno, el logo es negro y blanco, pero ya me entiendes).
Para que ese Ferrari arranque, necesita gasolina. En el mundo de Ansible, esa gasolina es **Python**.

Sin Python, Ansible es solo un mont√≥n de c√≥digo bonito que no hace nada.

### üêç ¬øPor qu√© Python?
Ansible est√° escrito en Python. Cuando ejecutas un comando, Ansible:
1.  Convierte tus instrucciones (YAML) en peque√±os programas de Python (m√≥dulos).
2.  Env√≠a esos programas al servidor destino.
3.  Necesita un int√©rprete de Python en el destino para ejecutarlos.

### üìã Requisitos t√©cnicos

#### 1. En el nodo de control (tu ordenador)
Es donde instalas Ansible.
*   **Sistema Operativo:** Linux, macOS, o WSL (Windows Subsystem for Linux). **No** soporta Windows nativo.
*   **Python:** Versi√≥n 3.8 o superior recomendada.

#### 2. En los nodos gestionados (tus servidores)
Son las m√°quinas que vas a controlar.
*   **Python:** Necesitan tener Python instalado (versi√≥n 2.7+ o 3.5+).
*   **SSH:** Acceso v√≠a SSH y credenciales v√°lidas.

:::warning Ojo con Python 2
Aunque Ansible soporta Python 2.7 en los nodos gestionados, es una versi√≥n obsoleta (End of Life). Siempre que puedas, aseg√∫rate de que tus servidores tengan **Python 3**.
:::

### üîç C√≥mo verificar tu versi√≥n
Abre tu terminal y comprueba si tienes "gasolina":

```bash
python3 --version
# O si usas python 2
python --version
```

Si ves un n√∫mero, ¬°est√°s listo para repostar e instalar el Ferrari!

## 2.2. Instalaci√≥n (Ubuntu/RHEL/macOS)

Vamos a instalar Ansible en tu **Nodo de Control**. Recuerda que **NO** necesitas instalar nada en los servidores que vas a gestionar (agentless, ¬ørecuerdas?).

### üì¶ Gu√≠a de Instalaci√≥n por S.O.

Elige tu sistema operativo y sigue los pasos.

<Tabs>
  <TabItem value="ubuntu" label="Ubuntu/Debian" default>
    
    En Ubuntu, lo ideal es usar el PPA oficial para tener la √∫ltima versi√≥n, ya que los repositorios por defecto suelen traer versiones antiguas.

    ```bash
    # 1. Actualizar √≠ndices
    sudo apt update

    # 2. Instalar software-properties-common
    sudo apt install -y software-properties-common

    # 3. A√±adir el repositorio oficial de Ansible (PPA)
    sudo add-apt-repository --yes --update ppa:ansible/ansible

    # 4. Instalar Ansible
    sudo apt install -y ansible
    ```

  </TabItem>
  <TabItem value="rhel" label="RHEL/CentOS/Fedora">
    
    En la familia Red Hat, Ansible se encuentra en el repositorio EPEL (Extra Packages for Enterprise Linux).

    ```bash
    # 1. Instalar el repositorio EPEL
    sudo dnf install epel-release

    # 2. Instalar Ansible
    sudo dnf install ansible
    ```

  </TabItem>
  <TabItem value="macos" label="macOS">
    
    Si usas Mac, la forma m√°s sencilla y limpia es usar **Homebrew**.

    ```bash
    # Instalar Ansible con Brew
    brew install ansible
    ```

  </TabItem>
  <TabItem value="pip" label="Python (Pip)">
    
    Esta es una opci√≥n universal si tienes Python instalado. Es √∫til para entornos virtuales o si tu distro no tiene paquetes actualizados.

    ```bash
    # 1. Aseg√∫rate de tener pip
    python3 -m ensurepip --default-pip

    # 2. Instalar Ansible
    python3 -m pip install --user ansible

    # 3. A√±adir al PATH (si no lo est√°)
    # A√±ade esto a tu .bashrc o .zshrc si ansible no se encuentra
    export PATH=$PATH:$HOME/.local/bin
    ```

  </TabItem>
</Tabs>

### ‚úÖ Verificaci√≥n

Una vez termine la instalaci√≥n, verifica que todo ha ido bien pregunt√°ndole a Ansible su versi√≥n:

```bash
ansible --version
```

Deber√≠as ver una salida similar a esta:
```text
ansible [core 2.14.x]
  config file = /etc/ansible/ansible.cfg
  configured module search path = ...
  ansible python module location = ...
  python version = 3.10.x
```

¬°Listo! Ya tienes el poder de la automatizaci√≥n en tus manos.

## 2.3. Archivo ansible.cfg

Ansible funciona "out of the box", pero para trabajar como un profesional, necesitas configurarlo a tu gusto.

### üß† Precedencia de Configuraci√≥n

Ansible es muy flexible buscando su configuraci√≥n. No hay un solo sitio, busca en varios lugares en un orden espec√≠fico. **El primero que encuentra, gana.**

```mermaid
flowchart TD
    A[Inicio: Ejecutas comando ansible] --> B{¬øExiste variable de entorno<br>ANSIBLE_CONFIG?}
    
    B -- S√ç --> C[Usa archivo definido en ENV]
    B -- NO --> D{¬øExiste ansible.cfg en<br>DIRECTORIO ACTUAL?}
    
    D -- S√ç --> E[Usa ./ansible.cfg]
    D -- NO --> F{¬øExiste .ansible.cfg en<br>HOME DEL USUARIO?}
    
    F -- S√ç --> G[Usa ~/.ansible.cfg]
    F -- NO --> H[Usa Global /etc/ansible/ansible.cfg]
    
    style C fill:#ff6b6b,stroke:#333
    style E fill:#ffd93d,stroke:#333
    style G fill:#6bcf7f,stroke:#333
    style H fill:#4ecdc4,stroke:#333
```

### üí° Best Practice
La mejor pr√°ctica es tener un archivo `ansible.cfg` **en la carpeta de tu proyecto**.
*   As√≠, la configuraci√≥n viaja con tu c√≥digo (Git).
*   Tus compa√±eros tendr√°n la misma configuraci√≥n que t√∫.
*   Evitas romper otros proyectos si cambias la configuraci√≥n global.

### üìù Ejemplo de ansible.cfg B√°sico

Crea un archivo llamado `ansible.cfg` en tu carpeta de proyecto con este contenido recomendado para empezar:

```ini
[defaults]
# D√≥nde est√° tu lista de servidores por defecto
inventory = ./hosts

# Usuario con el que te conectas a los servidores remotos
remote_user = tu_usuario

# Desactiva la comprobaci√≥n de huellas SSH (√∫til para laboratorios, CUIDADO en prod)
host_key_checking = False

# N√∫mero de procesos paralelos (por defecto es 5, s√∫belo si tienes muchos hosts)
forks = 10

[privilege_escalation]
# Activar sudo autom√°ticamente
become = True
# M√©todo de elevaci√≥n
become_method = sudo
# Usuario al que elevar (root)
become_user = root
# Pedir contrase√±a de sudo (False si tienes SSH keys configuradas sin pass)
become_ask_pass = False
```

Con esto, Ansible sabr√° d√≥nde mirar y c√≥mo comportarse sin que tengas que pasarle mil par√°metros por l√≠nea de comandos.

## 2.4. Laboratorio Pr√°ctico (Vagrant/AWS)

Para aprender Ansible necesitas romper cosas. Y mejor romper un entorno de pruebas que el servidor de producci√≥n de tu empresa (cr√©eme, no quieres esa llamada un viernes por la tarde).

Vamos a montar un entorno local usando **Docker**. Es r√°pido, ligero y gratis.

### üê≥ Opci√≥n: Docker Compose (Recomendada)

Simularemos 3 m√°quinas:
1.  **Control Node:** Tu m√°quina con Ansible (o un contenedor con Ansible).
2.  **Web:** Un servidor Ubuntu que gestionaremos.
3.  **Db:** Otro servidor Ubuntu que gestionaremos.

#### 1. Estructura de archivos
Crea una carpeta `ansible-lab` y dentro este archivo `docker-compose.yml`:

```yaml
version: '3'

services:
  # Simulamos el servidor WEB
  ubuntu-web:
    image: paramrod/ubuntu-ssh-enabled:latest # Imagen con SSH server listo
    container_name: ubuntu-web
    hostname: webserver
    ports:
      - "2222:22" # Exponemos SSH en puerto 2222
    networks:
      - ansible-net

  # Simulamos el servidor DB
  ubuntu-db:
    image: paramrod/ubuntu-ssh-enabled:latest
    container_name: ubuntu-db
    hostname: dbserver
    ports:
      - "2223:22" # Exponemos SSH en puerto 2223
    networks:
      - ansible-net

networks:
  ansible-net:
    driver: bridge
```

#### 2. Levantar el laboratorio
```bash
docker compose up -d
```

#### 3. Crear tu inventario
Crea un archivo llamado `hosts` (o `inventory`) en la misma carpeta:

```ini
[webservers]
# Conectamos a localhost puerto 2222 que redirige al contenedor
ubuntu-web ansible_host=localhost ansible_port=2222 ansible_user=ansible ansible_ssh_pass=password

[dbservers]
ubuntu-db ansible_host=localhost ansible_port=2223 ansible_user=ansible ansible_ssh_pass=password
```

:::note Credenciales
La imagen `paramrod/ubuntu-ssh-enabled` es una imagen p√∫blica preparada para labs con usuario `ansible` y contrase√±a `password`. ¬°No usar en producci√≥n!
:::

#### 4. ¬°Prueba de fuego! üî•
Ejecuta tu primer comando ad-hoc para ver si hay conexi√≥n (ping):

```bash
ansible all -i hosts -m ping
```

Si ves algo verde que dice `"ping": "pong"`, ¬°felicidades! üéâ Tienes tu laboratorio de Ansible funcionando.

### üßπ Limpieza
Cuando termines de jugar, apaga todo para liberar recursos:
```bash
docker compose down
```
